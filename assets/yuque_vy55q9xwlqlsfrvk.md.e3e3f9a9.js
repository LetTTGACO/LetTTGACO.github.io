import{_ as s,c as n,o as a,a as l}from"./app.c29b8955.js";const E=JSON.parse('{"title":"持续集成","description":"","frontmatter":{},"headers":[],"relativePath":"yuque/vy55q9xwlqlsfrvk.md","lastUpdated":1700497607000}'),p={name:"yuque/vy55q9xwlqlsfrvk.md"},o=l(`<h1 id="持续集成" tabindex="-1">持续集成 <a class="header-anchor" href="#持续集成" aria-hidden="true">#</a></h1><h2 id="自动化流程" tabindex="-1">自动化流程 <a class="header-anchor" href="#自动化流程" aria-hidden="true">#</a></h2><p><img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/1552a42c17e0286b8df50cda9826a05f.png" alt="image.png"></p><h2 id="语雀示例" tabindex="-1">语雀示例 <a class="header-anchor" href="#语雀示例" aria-hidden="true">#</a></h2><p><strong>语雀 + webhooks + serverless api + GitHub Actions + Github Pages 持续集成</strong><img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/39a31239945bc9632dfa9c862b24209c.png" alt="image.png"></p><h3 id="语雀-webhooks" tabindex="-1">语雀 webhooks <a class="header-anchor" href="#语雀-webhooks" aria-hidden="true">#</a></h3><p>在语雀知识库 - 更多设置 - 消息推送中可配置语雀 webhooks，填写一个支持 POST 请求的 APi 链接即可（这里以 serverless api 为例）。当文档更新时，语雀会调用这个 API 进行推送</p><blockquote><p>令人遗憾的是，语雀将 webhooks 收费了 未开通会员的语雀小伙伴可直接手动调用 API 触发 Github Actions 进行自动化构建&amp;部署 ⚠️ 知识库配置了「自动发布」功能后，文档的 更新/发布 操作暂不会发送 webhooks</p></blockquote><p><img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/21aa774671484590fe816c2a38e14a9a.png" alt="image.png"></p><h3 id="serverless-api" tabindex="-1"><strong>serverless api</strong> <a class="header-anchor" href="#serverless-api" aria-hidden="true">#</a></h3><p>为了方便，这里提供一个部署在 Vercel 的免费公用的<a href="https://github.com/LetTTGACO/serverless-api" target="_blank" rel="noreferrer">ServerlessAPI</a> 将其填入语雀 Webhooks 中即可</p><blockquote><p>未开通会员的语雀小伙伴可直接手动调用此 API 触发 Github Actions 进行自动化构建&amp;部署</p></blockquote><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//serverless-api-elog.vercel.app/api/github?user=xxx&amp;repo=xxx&amp;event_type=xxx&amp;token=xxx</span></span>
<span class="line"></span></code></pre></div><h3 id="配置-package-json" tabindex="-1">配置 package.json <a class="header-anchor" href="#配置-package-json" aria-hidden="true">#</a></h3><p>在自动化流程中不要忘记将<code>@elog/cli</code>安装到<code>package.json</code></p><blockquote><p>npm i @elog/cli 或者 yarn add @elog/cli 或者 pnpm i @elog/cli</p></blockquote><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vitepress or hexo 或者其他自定义的命令，具体以自己的工具为准</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog:init</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog init</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">sync:local</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog sync -e .elog.env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 本地同步时需要从env中取值</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">sync</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog sync</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 进行同步</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">clean</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog clean</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="github-actions" tabindex="-1">Github Actions <a class="header-anchor" href="#github-actions" aria-hidden="true">#</a></h3><ol><li>在仓库的<code>设置-Secrets and variables-Actions-Secrets</code>中进行配置需要用到的环境变量</li><li>在仓库根目录创建<code>.github/workflows/main.yaml</code>文件，并按照以下流程配置</li></ol><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Deplo To Github Pages</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># 允许手动push触发</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">push</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">master</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># 允许外部仓库事件触发</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">repository_dispatch</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">types</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">deploy</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># api中的event_type就是这个</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">jobs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">runs-on</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">steps</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">检查分支</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">actions/checkout@master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">安装node环境</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">actions/setup-node@master</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">node-version</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">16.x</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">安装pnpm</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          export TZ=&#39;Asia/Shanghai&#39;</span></span>
<span class="line"><span style="color:#C3E88D;">          npm install pnpm@7.9.5 -g</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">安装依赖</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          export TZ=&#39;Asia/Shanghai&#39;</span></span>
<span class="line"><span style="color:#C3E88D;">          pnpm install --prod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">拉取语雀/Notion的文章</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 语雀相关环境变量</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">YUQUE_TOKEN</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.YUQUE_TOKEN }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">YUQUE_LOGIN</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.YUQUE_LOGIN }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">YUQUE_REPO</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.YUQUE_REPO }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># Notion相关环境变量</span></span>
<span class="line"><span style="color:#BABED8;">					</span><span style="color:#F07178;">NOTION_TOKEN</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.NOTION_TOKEN }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">NOTION_DATABASE_ID</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.NOTION_DATABASE_ID }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 图床相关环境变量，以腾讯云COS为例</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_SECRET_ID</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_SECRET_ID }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_SECRET_KEY</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_SECRET_KEY }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_IMAGE_BUCKET</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_IMAGE_BUCKET }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_IMAGE_REGION</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_IMAGE_REGION }}</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          # 对应package.json中的script.sync</span></span>
<span class="line"><span style="color:#C3E88D;">          pnpm sync</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">配置Git用户名邮箱</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          git config --global user.name &quot;xxxx&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">          git config --global user.email &quot;xxxx&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">提交yuque拉取的文章到GitHub仓库</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          echo \`date +&quot;%Y-%m-%d %H:%M:%S&quot;\` begin &gt; time.txt</span></span>
<span class="line"><span style="color:#C3E88D;">          git add .</span></span>
<span class="line"><span style="color:#C3E88D;">          git commit -m &quot;更新文档&quot; -a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">推送文章到仓库</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ad-m/github-push-action@master</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">github_token</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">生成静态文件</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          # 对应package.json中的script.build</span></span>
<span class="line"><span style="color:#C3E88D;">          pnpm build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">部署到Github Pages</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># github_token和personal_token适用于推送到当前仓库</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 也就是你的Github Pages仓库（xxxx/xxxx.github.io）</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 一般都不直接在Github Pages仓库开发，所以推荐使用deploy_key</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># github_token: \${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># personal_token: \${{ secrets.PERSONAL_TOKEN }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># deploy_key可以推送到别的仓库, SSH_PRIVATE_KEY 为自己电脑的ssh私钥</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">deploy_key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 具体目录以自己的工具为准</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">publish_dir</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">docs/.vitepress/dist</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">external_repository</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxxx/xxxx.github.io</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">publish_branch</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">master</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">commit_message</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ github.event.head_commit.message }}</span></span>
<span class="line"></span></code></pre></div><h2 id="notion-示例" tabindex="-1">Notion 示例 <a class="header-anchor" href="#notion-示例" aria-hidden="true">#</a></h2><p><strong>Notion + Slack + pipedream + serverless api + GitHub actions + Github Pages 持续集成</strong><img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/8fca86a5a136064864289ca46d750620.png" alt="image.png"></p><h3 id="配置数据表-slack-notifications" tabindex="-1">配置数据表 <strong>Slack notifications</strong> <a class="header-anchor" href="#配置数据表-slack-notifications" aria-hidden="true">#</a></h3><p>设置数据表文档字段被扭转到某个状态时向 Slack 发送消息 <img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/68ecd96d9ff85bcd88bdc491ce08c85b.png" alt="image.png"></p><h3 id="注册-slack-账号并授权给-notion" tabindex="-1">注册 Slack 账号并授权给 Notion <a class="header-anchor" href="#注册-slack-账号并授权给-notion" aria-hidden="true">#</a></h3><p>当 Notion 数据表的文档字段被扭转到某个状态时向 Slack 发送消息，此时 Slack 收到消息提醒 <img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/4a9b45b0dc5e293409a6f0e4b0d1faae.png" alt="image.png"></p><h3 id="serverless-api-1" tabindex="-1"><strong>serverless api</strong> <a class="header-anchor" href="#serverless-api-1" aria-hidden="true">#</a></h3><p>为了方便，这里提供一个部署在 Vercel 的免费公用的<a href="https://github.com/LetTTGACO/serverless-api" target="_blank" rel="noreferrer">ServerlessAPI</a></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//serverless-api-elog.vercel.app/api/github?user=xxx&amp;repo=xxx&amp;event_type=xxx&amp;token=xxx</span></span>
<span class="line"></span></code></pre></div><h3 id="注册pipedream-并配置-workflow" tabindex="-1">注册<strong>pipedream 并配置 WorkFlow</strong> <a class="header-anchor" href="#注册pipedream-并配置-workflow" aria-hidden="true">#</a></h3><h4 id="第一步-选择-channels-为-notion-应用" tabindex="-1">第一步：选择 Channels 为 Notion 应用 <a class="header-anchor" href="#第一步-选择-channels-为-notion-应用" aria-hidden="true">#</a></h4><blockquote><p>你也可以在 Notion 中配置发送消息到某个频道，然后在 pipedream 选择所选频道的 Channel。支持多选 Channels</p></blockquote><p><img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/884ea1fc84d11e2127d7978cd7d2327a.png" alt="image.png"></p><h4 id="第二步-收到-notion-消息后发送自定义-http-请求" tabindex="-1">第二步：收到 Notion 消息后发送自定义 Http 请求 <a class="header-anchor" href="#第二步-收到-notion-消息后发送自定义-http-请求" aria-hidden="true">#</a></h4><p>将调用 Github Actions 的 serverless api 填入即可 <img src="https://blogimagesrep-1257180516.cos.ap-guangzhou.myqcloud.com/elog-docs-images/eb8bd89a65f89d20c8c091179ec5feca.png" alt="image.png"></p><h3 id="配置-package-json-1" tabindex="-1">配置 package.json <a class="header-anchor" href="#配置-package-json-1" aria-hidden="true">#</a></h3><p>在自动化流程中不要忘记将<code>@elog/cli</code>安装到<code>package.json</code></p><blockquote><p>npm i @elog/cli 或者 yarn add @elog/cli 或者 pnpm i @elog/cli</p></blockquote><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vitepress or hexo 或者其他自定义的命令，具体以自己的工具为准</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog:init</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog init</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">sync:local</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog sync -e .elog.env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 本地同步时需要从env中取值</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">sync</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog sync</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 进行同步</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">clean</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">elog clean</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="github-actions-1" tabindex="-1">Github Actions <a class="header-anchor" href="#github-actions-1" aria-hidden="true">#</a></h3><ol><li>在仓库的<code>设置-Secrets and variables-Actions-Secrets</code>中进行配置需要用到的环境变量</li><li>在仓库根目录创建<code>.github/workflows/main.yaml</code>文件，并按照以下流程配置</li></ol><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Deplo To Github Pages</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># 允许手动push触发</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">push</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">master</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># 允许外部仓库事件触发</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">repository_dispatch</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">types</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">deploy</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># api中的event_type就是这个</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">jobs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">runs-on</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">steps</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">检查分支</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">actions/checkout@master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">安装node环境</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">actions/setup-node@master</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">node-version</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">16.x</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">安装pnpm</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          export TZ=&#39;Asia/Shanghai&#39;</span></span>
<span class="line"><span style="color:#C3E88D;">          npm install pnpm@7.9.5 -g</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">安装依赖</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          export TZ=&#39;Asia/Shanghai&#39;</span></span>
<span class="line"><span style="color:#C3E88D;">          pnpm install --prod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">拉取语雀/Notion的文章</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 语雀相关环境变量</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">YUQUE_TOKEN</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.YUQUE_TOKEN }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">YUQUE_LOGIN</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.YUQUE_LOGIN }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">YUQUE_REPO</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.YUQUE_REPO }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># Notion相关环境变量</span></span>
<span class="line"><span style="color:#BABED8;">					</span><span style="color:#F07178;">NOTION_TOKEN</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.NOTION_TOKEN }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">NOTION_DATABASE_ID</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.NOTION_DATABASE_ID }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 图床相关环境变量，以腾讯云COS为例</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_SECRET_ID</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_SECRET_ID }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_SECRET_KEY</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_SECRET_KEY }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_IMAGE_BUCKET</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_IMAGE_BUCKET }}</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">COS_IMAGE_REGION</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.COS_IMAGE_REGION }}</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          # 对应package.json中的script.sync</span></span>
<span class="line"><span style="color:#C3E88D;">          pnpm sync</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">配置Git用户名邮箱</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          git config --global user.name &quot;xxxx&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">          git config --global user.email &quot;xxxx&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">提交yuque拉取的文章到GitHub仓库</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          echo \`date +&quot;%Y-%m-%d %H:%M:%S&quot;\` begin &gt; time.txt</span></span>
<span class="line"><span style="color:#C3E88D;">          git add .</span></span>
<span class="line"><span style="color:#C3E88D;">          git commit -m &quot;更新文档&quot; -a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">推送文章到仓库</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ad-m/github-push-action@master</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">github_token</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">生成静态文件</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          # 对应package.json中的script.build</span></span>
<span class="line"><span style="color:#C3E88D;">          pnpm build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">部署到Github Pages</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># github_token和personal_token适用于推送到当前仓库</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 也就是你的Github Pages仓库（xxxx/xxxx.github.io）</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 一般都不直接在Github Pages仓库开发，所以推荐使用deploy_key</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># github_token: \${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># personal_token: \${{ secrets.PERSONAL_TOKEN }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># deploy_key可以推送到别的仓库, SSH_PRIVATE_KEY 为自己电脑的ssh私钥</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">deploy_key</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ secrets.SSH_PRIVATE_KEY }}</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;"># 具体目录以自己实际情况为准</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">publish_dir</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">docs/.vitepress/dist</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">external_repository</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xxxx/xxxx.github.io</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">publish_branch</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">master</span></span>
<span class="line"><span style="color:#BABED8;">          </span><span style="color:#F07178;">commit_message</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">\${{ github.event.head_commit.message }}</span></span>
<span class="line"></span></code></pre></div>`,42),e=[o];function t(c,r,y,D,i,F){return a(),n("div",null,e)}const A=s(p,[["render",t]]);export{E as __pageData,A as default};
